\section{Discretisation}\label{sec:discrete}
The continuous system described in the previous section is discretised using FDTD methods, which subdivide continuous equations into discrete points in space and time. Before moving on to this discretisation, we briefly introduce these methods along with several finite-difference operators.

\subsection{Numerical Methods}\label{sec:numMeth}
Consider a 1D system described by state variable $u = u(x,t)$ with spatial domain $x\in \mathbb{R}$ and time $t\geq 0$. The spatial domain can be disctretised according to $x=lh$ with spatial index $l \in \mathbb{Z}$ and grid spacing $h$ (in m) and time as $t=nk$ with temporal index $n \in \mathbb{Z}^{0+}$ and time step $k$ (in s). Using these discrete variables state variable $u(x,t)$ can be discretised to grid function $u_l^n$. 

Shift operators can then be applied to grid function $u_l^n$. Temporal and spatial shift operators are
\begin{equation}
    \begin{aligned}
        e_{t+}u_l^n &= u_l^{n+1}, \quad e_{t-}u_l^n = u_l^{n-1},\\
        e_{x+}u_l^n &= u_{l+1}^n\;, \quad \!e_{x-}u_l^n = u_{l-1}^n,
    \end{aligned}
\end{equation}
from which more complex operators can be derived.
First-order derivatives can be approximated using forward, backward and centered difference operators in time
\begin{equation}\label{eq:discTimeOperators}
    \delta_{t+} = \frac{e_{t+} - 1}{k},\ \delta_{t-} = \frac{1 - e_{t-}}{k},\ \delta_{t\cdot} = \frac{e_{t+}-e_{t-}}{2k},
\end{equation}
(all approximating $\partial_t$) and space
\begin{equation}\label{eq:discSpaceOperators}
    \delta_{x+} = \frac{e_{x+} - 1}{h},\ \delta_{x-} = \frac{1 - e_{x-}}{h},\ \delta_{x\cdot} = \frac{e_{x+}-e_{x-}}{2h},
\end{equation} 
(all approximating $\partial_x$) where the identity operator $1$ does not introduce any shift.

Furthermore, forward, backward and centered averaging operators can be defined in time
\begin{equation}
    \mu_{t+} = \frac{e_{t+} + 1}{2}, \ \mu_{t-} = \frac{1 + e_{t-}}{2}, \ \mu_{t\cdot} = \frac{e_{t+}+e_{t-}}{2},
\end{equation}
and space
\begin{equation}
    \mu_{x+} = \frac{e_{x+} + 1}{2}, \ \mu_{x-} = \frac{1 + e_{x-}}{2}, \ \mu_{x\cdot} = \frac{e_{x+}+e_{x-}}{2}.
\end{equation}
Here, forward and backward averaging operators are extremely useful in the context of first-order systems as used in this paper. When applied to a grid function, the result may be interpreted as its value shifted by half a temporal or spatial step: 
\begin{align}
    \mu_{t+}u_l^n &= u_l^{n+1/2}, \quad \mu_{t-}u_l^n = u_l^{n-1/2},\\
    \mu_{x+}u_l^n &= u_{l+1/2}^n, \quad \mu_{x-}u_l^n = u_{l-1/2}^n,
\end{align}
effectively placing the grid function on an \textit{interleaved grid} which will be further elaborated on in the following. 

\subsection{Discrete Tube}\label{sec:discSyst}
We start discretising system \eqref{eq:firstOrderSystem} by placing velocity $v$ on an interleaved grid, following \cite{Harrison2018}, both in space and time. Domain $x\in [0, L]$ can be discretised to $l = [0, \hdots, N]$ where number of intervals between grid points is calculated using 
\begin{equation}\label{eq:numberOfIntervals}
    N=\lfloor L/h\rfloor.
\end{equation}

The grid functions $p_l^n \approx p(x,t)$ and $v_{l+1/2}^{n+1/2} \approx v(x,t)$ (with reduced domain $l = [0, \hdots, N-1]$) with $N+1$ and $N$ grid points respectively are then introduced along with discrete cross-sectional area $S_l\approx S(x)$ sampled at $x = lh$ to which the spatial operators defined in Section \ref{sec:numMeth} can also be applied.

System \eqref{eq:firstOrderSystem} can then be discretised into the following system of FDSs
\begin{subequations}\label{eq:FDS}
    \begin{align}
        \frac{\bar S_l}{\rho_0 c^2}\delta_{t+}p_l^n &= -\delta_{x-}(S_{l+1/2}v_{l+1/2}^{n+1/2}),\label{eq:discPressure}\\
        \rho_0 \delta_{t-}v_{l+1/2}^{n+1/2}&=-\delta_{x+}p_l^n,\label{eq:discVelocity}
    \end{align}
\end{subequations}
where $S_{l+1/2} = \mu_{x+}S_l$ and $\bar S_l = \mu_{x-}S_{l+1/2}$ are approximations to the continuous cross-sectional area $S(x)$. The values for $\bar S_l$ at the boundaries, i.e., $\bar S_0$ and $\bar S_N$ are set equal to $S(0)$ and $S(L)$.

Expanding the operators, we obtain the following recursion
\begin{subequations}\label{eq:updateNormal}
    \begin{align}
        p_l^{n+1} &= p_l^n - \frac{\rho_0 c \lambda}{\bar{S}_l}(S_{l+1/2}v_{l+1/2}^{n+1/2}-S_{l-1/2}v_{l-1/2}^{n+1/2}),\label{eq:pressureUpdate}\\
        v_{l+1/2}^{n+1/2} &= v_{l+1/2}^{n-1/2}-\frac{\lambda}{\rho_0 c}(p_{l+1}^n - p_l^n),\label{eq:velocityUpdate}
    \end{align}
\end{subequations}
where $\lambda = ck/h$ is referred to as the Courant number and
\begin{equation}
    \lambda \leq 1
\end{equation}
in order for the scheme to be stable. 

Finally, the boundary conditions in \eqref{eq:contBound} can be discretised as
\begin{subequations}
    \begin{align}
        \mu_{x-}\left(S_{1/2}v_{1/2}^{n+1/2}\right) = 0\label{eq:discNeumann}\\
        p_N^n = 0\label{eq:discDirich}
    \end{align}    
\end{subequations}

\subsection{Lip reed}
As the lip reed interacts with the particle velocity of the tube, it is placed on the interleaved temporal grid, but kept on the regular spatial grid, as it interacts with the boundary at $l=0$.

Equations \eqref{eq:lipReedCont} - \eqref{eq:lipBoundary} are discretised as follows \SWcomment[Still need to add collision here, but I'm in doubt as to whether I want to include it at all.. The effect on the system is negligible for the values I'm using and it's going to take up a lot of space to explain]:
\def\nphSys{n+1/2}
\begin{subequations}\label{eq:discreteLipSystem}
    \begin{align}
    &\begin{aligned}
        M_\text{r}\delta_{tt}y^{\nphSys} =&-M_\text{r}\omega_0^2\mu_{t\cdot}y^{\nphSys} -M_\text{r}\sigma_\text{r}\delta_{t\cdot}y^{\nphSys}\\
        &+S_\text{r}\Delta p^{\nphSys}
    \end{aligned}\label{eq:discReed}\\
    &\Delta p^{\nphSys} = P_\text{m} - \mu_{t+}p_0^n\label{eq:pDiff}\\
    &\begin{aligned}
        U_\text{B}^{\nphSys} =&\ w[\eta^{\nphSys}]_+\text{sgn}(\Delta p^{\nphSys})\label{eq:bernoulli}\\
        &
        \cdot\sqrt{2|\Delta p^{\nphSys}|/\rho_0}
    \end{aligned}\\
    &U_\text{r}^{\nphSys}= S_\text{r}\delta_{t\cdot}y^{\nphSys}\label{eq:Ur}\\
    &\mu_{x-}(S_{1/2}v_{1/2}^{\nphSys})= U_\text{B}^{\nphSys} + U_\text{r}^{\nphSys}\label{eq:UbUr}
    \end{align}
\end{subequations}
Boundary condition \eqref{eq:discNeumann} can be modified to Eq. \eqref{eq:UbUr}, effectively coupling the lip reed to the tube. 
% \begin{subnumcases}{\label{eq:discreteLipSystem}}
%     M_\text{r}\delta_{tt}y^{\nphSys} = -M_\text{r}\omega_0^2\mu_{t\cdot}y^{\nphSys} -M_\text{r}\sigma_\text{r}\delta_{t\cdot}y^{\nphSys}\label{eq:discReed}\\\qquad \qquad \qquad \ \ \ 
%     +\ S_\text{r}\Delta p^{\nphSys}\nonumber\\
%     \Delta p^{\nphSys} = P_\text{m} - \mu_{t+}p_0^n\label{eq:pDiff}\\
%     U_\text{B}^{\nphSys} = w[y^{\nphSys}+H_0]_+\text{sgn}(\Delta p^{\nphSys})\label{eq:bernoulli}\\\qquad \qquad \ \ \ 
%     \cdot\ \sqrt{2|\Delta p^{\nphSys}|/\rho_0}\nonumber\\
%     U_\text{r}^{\nphSys}= S_\text{r}\delta_{t\cdot}y^{\nphSys}\label{eq:Ur}\\
%     \mu_{x-}(S_{1/2}v_{1/2}^{\nphSys})= U_\text{B}^{\nphSys} + U_\text{r}^{\nphSys}\label{eq:UbUr}
% \end{subnumcases}

% \begin{subnumcases}{\label{eq:discreteLipSystem}}
%     M_\text{r}\delta_{tt}y^{\nphSys} & $= -M_\text{r}\omega_0^2\mu_{t\cdot}y^{\nphSys}-M_\text{r}\sigma_\text{r}\delta_{t\cdot}y^{\nphSys} + S_\text{r}\Delta p^{\nphSys}$\label{eq:discReed}\\
%     \Delta p^{\nphSys} & $= P_\text{m} - \mu_{t+}p_0^n$\label{eq:pDiff}\\
%     U_\text{B}^{\nphSys} & $= w[y^{\nphSys}+H_0]_+\text{sgn}(\Delta p^{\nphSys})\sqrt{\frac{2|\Delta p^{\nphSys}|}{\rho_0}}$\label{eq:bernoulli}\\
%     U_\text{r}^{\nphSys} & $= S_\text{r}\delta_{t\cdot}y^{\nphSys}$\label{eq:Ur}\\
%     \mu_{x-}(S_{1/2}v_{1/2}^{\nphSys})\!\!\!\!\! \!\!\!\!\! &$= U_\text{B}^{\nphSys} + U_\text{r}^{\nphSys}$\label{eq:UbUr}
% \end{subnumcases}